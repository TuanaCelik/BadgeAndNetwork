<!DOCTYPE html>
<meta charset="utf-8">
<title>Data Visualization Final Project</title>
<style>
@import url(http://fonts.googleapis.com/css?family=Wire+One);
body {
  margin: auto;
  position: relative;
  padding: 20px;
  height: 100%;
}
 
form {
  position: absolute;
  right: 1000px;
  top: 1000px;
}

figure {
	position: absolute;
	left: 1000;
	top: 0;
	float: right;
	width: 100%;
}

.canvas {
	font-family: 'Cabin', sans-serif;
 	font-size: 14px;
 	/*fill: #f48641;*/
 	font-weight: normal;
}

.node {
    border: solid 2px white;
    line-height: 0.95;
    overflow: hidden;
    position: absolute;
    border-radius: 10px;
}

.node div {
   padding: 6px 4%;
}

</style>
  <!-- <script src="http://d3js.org/d3.v3.min.js"></script> -->
<body>
<script src="d3/d3.v3.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script type="text/javascript" src="script.js"></script>
<script>


d3.csv("topCommSize.csv", function(error, data) {
  var mapped_children = data.map(function(d)
  {
    name = d.destIP;
    size = d.Size/10;
    freq = d.Freq/10;
    return {"name":name, "size":size, "freq":freq};
  })

	var tree = {
	    name: "tree",
	    children: mapped_children
	};

	var width = 600,
	    height = 600,
	    color = d3.interpolateReds,
	    div = d3.select("body").append("div")
	       .style("position", "relative");

	var treemap = d3.layout.treemap()
	    .size([width, height])
	    .sticky(true)
	    .value(function(d) { return d.size; });


	 
	var node = div.datum(tree).selectAll(".node")
	      .data(treemap.nodes)
	      .enter().append("div")
	      .attr("class", "node")
	      .call(position)
	      .style("background-color", function(d) {
	      	  //console.log(1-((1/d.freq)*50));
	          return d.name == 'tree' ? '#fff' : color(1-((1/d.freq)*50)); })
	      .append('div')
	      .style("font-size", function(d) {
	          // compute font size based on sqrt(area)
	          return Math.max(20, 0.1*Math.sqrt(d.area))+'px'; })
	      .text(function(d) { return d.children ? null : d.name; });
	 
	function position() {
	  this.style("left", function(d) { return d.x + "px"; })
	      .style("top", function(d) { return d.y + "px"; })
	      .style("width", function(d) { return Math.max(0, d.dx - 1) + "px"; })
	      .style("height", function(d) { return Math.max(0, d.dy - 1) + "px"; });
	}  
}),

d3.csv("piggy.csv", function(error, data){
	var rose = Chart.rose(),
			height = 1000,
			color = d3.interpolateReds,
			labels = [];
	for(var i = 0; i < 60; i++){
		labels.push(i);
	}

	var scalar;
	data.forEach( function(d) { 
		d.label = labels[d.id];
		scalar = 100*60 / labels.size;
		d.piggyNum = d.piggyNum * scalar;
	} );

	// Get the maximum value:
	var maxVal = d3.max( data, function(d) {
		return d3.max( [6, d.piggyNum] );
	});

	// Where the maximum value gives us the maximum radius:
	var maxRadius = Math.sqrt(maxVal*36 / Math.PI) / 1.5;
	
	// Append a new figure to the DOM:
	figure = d3.select( 'body' )
		.append( 'figure' );

	// Get the figure width:
	width = parseInt( figure.style( 'width' ), 10 );

	// Update the chart generator settings:
	rose.legend(labels)
		.width( width )
		.height( height )
		.delay( 0 )
		.duration( 500 )
		.domain( [0, maxRadius] )
		.angle( function(d) { return d.id; } )
		.area( function(d, i) { return [d.id]; } );
	// Bind the data and generate a new chart:
	figure.datum( data )
		.attr('class', 'canvas')
		.call( rose );

}); 
</script>
</body>